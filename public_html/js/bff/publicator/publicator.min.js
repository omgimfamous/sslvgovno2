/**
 * Bff.Publicator.js (bff\db\Publicator component)
 * @author Tamaranga | tamaranga.com
 * @version 1.84
 * @cl b0361046eed84fb0b6831bf884a9f319
 * @modified 17.mar.2015
 */
var bffPublicator=function(){function e(e,l){function o(){N.on("click",".controls a",function(e){nothing(e);var t=$(this).attr("rel"),s=T;switch(t){case"photo":return;case"text":w(i.text,S(i.text,s,a.lang.text_tip,"",a.useWY?"wy":""),!0),x(s).find("textarea:visible").focus();break;case"quote":w(i.quote,S(i.quote,s,a.lang.text_tip,"",a.useWY?"wy":""),!0),x(s).find("textarea:visible").focus();break;case"subtitle":w(i.subtitle,'<div class="subtitle">'+S(i.subtitle,s,a.lang.subtitle_tip,"","no-enter")+j("subtitle-size",s,0)+'<div class="clear"></div></div>',!0),x(s).find("textarea:visible").focus();break;case"video":w(i.video,'<div class="objectBlock">                                        <div class="overflow">'+S(i.video,s,a.lang.video_tip,"","video-url no-enter")+'<input class="btn btn-small button submit video-submit" type="button" rel="'+s+'" value="'+a.lang.video_submit+'" /></div><div class="desc">'+a.lang.video_supported+"</div>                                    </div>",!1),x(s).find("textarea").focus();break;case"gallery":I[s]={swfu:!1,photos:[],edit:!0,items:null,k:0,dnd:!1,dyn:!0,bytesTotal:!1,uploaded:0},w(i.gallery,'<div>                                <table style="width:100%;"><tbody class="gallery-items"></tbody></table>                                <span class="gallery-item relative"><span class="gallery-plus grey"><b>+</b></span><br /><a href="#">'+a.lang.photo_add+'</a><div id="pg-'+s+'-upload" class="gallery-upload"></div></span>                                <div class="clear-all"></div>                            </div>',!0),z(s);break;default:return}q=!1,n(!1),N.triggerHandler("click.controlsBack")}),N.on("focus focusin focusout blur keyup keydown","textarea",function(e){var t=$(this);switch(e.type){case"focus":case"focusin":a.useWY&&t.hasClass("wy")&&W(t.removeClass("wy")),t.addClass("active").next().addClass("hidden");break;case"blur":case"focusout":t.removeClass("active"),(!t.val().length||t.val().match(/^[\s\r\n]+$/))&&t.val("").height(a.textHeight).next().removeClass("hidden");break;case"keydown":if(t.hasClass("no-enter"))return 13!=e.keyCode;case"keyup":(!a.useWY||!a.wyPhoto&&t.hasClass("photo"))&&(bff.browser.msie||t.height(a.textHeight),t.height(t[0].scrollHeight))}}),N.on("click",".text-to-wy",function(){var e=$(this).parent().find("textarea").css({height:$(this).height()}).removeClass("wy");a.useWY?W(e):(e.removeClass("hidden"),$(this).hide())}),N.on("click mouseover mouseout","div.tip",function(e){switch(e.type){case"click":$(this).prev().focus();break;case"mouseover":$(this).prev().addClass("hover");break;case"mouseout":$(this).prev().removeClass("hover")}}),N.on("click","div.insert",function(){var e=$("> div.controlsBorder > div.controls",N),t=$(this).closest(".j-block");if(q=intval(t.attr("block-id"))){var a=intval(t.offset().top)-(intval(A.offset().top)+intval(A.height()));e.animate({top:a},500),N.bind("click.controlsBack",function(t){e.animate({top:0},500,function(){N.unbind("click.controlsBack")}),$(t.target).is("object.swfupload")||(q=!1)})}}),N.on("click","div.close",function(){var e=$(this).closest(".j-block"),t=e.attr("block-type"),s=intval(e.attr("block-id"));if(t==i.photo){var l=$("input.photo-content",e);if(!l.length||!l.val())return void C(e);var o=l.val();if(D(o)){if(!confirm(a.lang.del))return;return void bff.ajax(a.url+"img_delete",{photos:[[o,t]],id:a.id},function(t){t&&t.success&&(U(o),C(e))})}}else if(t==i.gallery&&I[s].dyn){var n=I[s].photos;if(n.length>0){if(!confirm(a.lang.del))return;var r=[];for(var s in n)r.push([n[s],t]);bff.ajax(a.url+"img_delete",{photos:r,id:a.id},function(t){t&&t.success&&(U(n),delete I[s],C(e))})}else delete I[s],C(e);return}(t!=i.photo&&t!=i.gallery||confirm(a.lang.del))&&($(this).parent().append(k(t,s,"del")),C(e,!0))}),J.on("click",'tbody tr[block-type="'+i.video+'"] input.video-submit',function(){var e=intval($(this).attr("rel")),i=$(this).parents(".mask").find("div.objectBlock"),s=i.find("textarea.video-url"),l=s.val()||"";return l.length?void bff.ajax(a.url+"video_validate",{url:l,id:a.id},function(l){l&&(l.correct?i.html(E(l.url,l.source,e,l)):(t(a.lang.video_not_valid),s.focus()))}):(s.focus(),!1)}),n(!1),I[0]={swfu:!1},c(0,i.photo,{placeholder:"photoBtnPlaceholder"});var e=!1;s.bind("beforeunload",function(){!e&&!Y&&B.length>0&&(e=!0,bff.ajax(a.url+"img_delete",{photos:B,id:a.id},function(){},!1,{async:!1}))});var l=N.closest("form:first");l.length&&l.submit(function(){Y=!0}),Q&&(l.find(".j-lang-togglers").length||N.find(".langs").show(),O=N.find(".langs a"),O.click(function(e){nothing(e),R($(this).attr("rel"))}))}function n(e){if(e!==!1&&e>0){var t=e,i=I[t],l=i.$items.parent();return $('a[rel="pg'+t+'"]',l).fancybox(),void(i.dnd?l.tableDnDUpdate():(void 0!=s.tableDnD&&l.tableDnD({onDragClass:"drag"}),i.dnd=!0))}if(M)$(J).tableDnDUpdate();else{if(void 0==s.tableDnD)return;$(J).tableDnD({dragHandle:".dragger div",onDragClass:"drag",onDrop:function(e,t){if(a.useWY){var i=intval($(t).attr("block-id"));i&&P[i]&&P[i].reinitIframe()}}}),M=!0}}function r(){if(a.m.title){var e=$(".publicatorTitle",N),t=Q?{}:e.html();Q&&e.find(">div").each(function(){t[$(this).attr("class")]=$(this).html()}),e.html(S(i.title,0,a.lang.title,t,"no-enter")).removeClass("hidden")}var s=!1,l="";$(".publicatorData > div",N).each(function(e){var t=[];$(">div",this).each(function(){var e=$(this),a=e.attr("class");Q&&"text"==a?(t[a]={},e.find(">div").each(function(){t[a][$(this).attr("class")]=$(this).html()})):t[a]=e.html()});var o=intval(t.type);switch(o){case i.text:case i.quote:l+=w(o,S(o,T,a.lang.text_tip,t.text,a.useWY?"hidden wy":""),!0,'<div class="edit"></div>',!0);break;case i.photo:l+=w(o,'<table width="100%">                                   <tr>                                     <td width="165"><div class="photo-progress"><img src="'+t.url_t+'" /></div></td>                                     <td valign="top">                                        <div class="photo-text">'+S(o,T,a.lang.photo_tip,t.text,a.wyPhotos?"hidden wy":"")+"</div>                                        "+j("photo-align",T,t.align)+"                                        "+j("photo-zoom",T,t.zoom)+'                                        <div class="clear"></div>                                     </td>                                   </tr></table>                                   <input type="hidden" name="'+k(o,T,!1)+'" value="'+t.photo+'" class="photo-content" />                                   <input type="hidden" name="'+k(!1,T,"view")+'" value="'+t.view+'" />                                 ',!0,"",!0);break;case i.gallery:var e=T,n=$.parseJSON(t.photos),r=[],d="",c=1,u="",p="";for(var v in n)d=n[v].photo,r.push(d),u+='<tr class="j-gallery-item-block"><td><span class="gallery-item">                                <input type="hidden" name="'+k(o,e,!1,"[p]["+c+"]")+'" class="photo-content" value="'+d+'" />                                <a href="'+n[v].url.v+'" rel="pg'+e+'"><img src="'+n[v].url.t+'" /></a>                            </span>                            <div class="gallery-edit">                               '+S(o,e,a.lang.photo_tip,n[v].text,"","[p]["+c+"]")+'<br /><br />                                <a href="#" class="ajax desc ph_del" rel="'+c+'">'+a.lang.photo_del+'</a>                            </div><div class="clear-all"></div></td></tr>',p+='<span class="gallery-item"><a href="'+n[v].url.v+'" rel="pg'+e+'"><img src="'+n[v].url.t+'" /></a></span>',c++;l+=w(o,'<div class="pg-edit displaynone"><table style="width:100%;"><tbody class="gallery-items">'+u+'</tbody></table>                                <span class="gallery-item relative"><span class="gallery-plus grey"><b>+</b></span><br /><a href="#">'+a.lang.photo_add+'</a><div id="pg-'+e+'-upload"></div></span>                                <div class="clear-all"></div></div>                                <div class="pg-view"><div class="gallery-items">'+p+'</div><div class="clear-all"></div></div>',!0,'<div class="edit"></div>',!0),I[e]={swfu:!1,photos:r,data:n,edit:!1,items:null,k:c,dnd:!1,dyn:!1,bytesTotal:!1,uploaded:r.length},s=!0;break;case i.video:l+=w(o,E(t.video,t.source,T,t),!1,"",!0);break;case i.subtitle:l+=w(o,'<div class="subtitle">'+S(o,T,a.lang.subtitle_tip,t.text,"no-enter")+j("subtitle-size",T,t.size)+'<div class="clear"></div></div>',!0,"",!0)}}),J.append("<tbody>"+l+"</tbody>"),setTimeout(function(){$("td.action > div.edit",N).click(function(){{var e=$(this).closest(".j-block");e.attr("block-type")}switch(intval(e.attr("block-type"))){case i.text:case i.quote:var t=e.find(".text-to-wy");t.length&&!t.hasClass("hidden")&&($(this).hide(),t.click());break;case i.gallery:z(intval(e.attr("block-id")))}}),s&&$('.j-block[block-type="'+i.gallery+'"] div.pg-view a[rel^="pg"]',N).fancybox()},1),a.debug||$(".publicatorData",N).remove(),$(".j-block textarea",N).each(function(e,t){$(t).height(t.scrollHeight>0?t.scrollHeight:20)})}function d(e){for(var t in P)P[t].sync();B=[],e&&e.length>0}function c(e,i,s){if(void 0==window.SWFUpload||!a.sessid.length)return void t("Ошибка инициализации SWFUpload");s.numFilesQueued=0,s.type=i;var l=e>0,o=l?72:32;I[e].swfu=new SWFUpload({upload_url:a.url+"img_upload",flash_url:"/js/bff/swfupload/swfupload.swf",post_params:{sessid:a.sessid,id:a.id,block_type:i},file_size_limit:a.upload.maxSize,file_types:"*.jpg;*.jpeg;*.gif;*.png",file_types_description:a.lang.images_all,file_upload_limit:l?a.m.gallery_photos_limit:0,swfupload_loaded_handler:u,file_dialog_complete_handler:h,file_queue_error_handler:g,file_queued_handler:f,upload_progress_handler:b,upload_complete_handler:m,upload_success_handler:y,upload_error_handler:_,button_image_url:"/js/bff/publicator/img/empty.gif",button_placeholder_id:s.placeholder,button_window_mode:"transparent",button_width:o,button_height:o,button_cursor:SWFUpload.CURSOR.HAND,custom_settings:s,debug:a.debug})}function u(){this.customSettings.type==i.gallery&&I[this.customSettings.index]&&p(this,I[this.customSettings.index].uploaded)}function p(e,t){var a=e.getStats();a.successful_uploads=t,e.setStats(a)}function v(e){return Math.round(e/1024*100)/100+" Kb"}function h(e,t){return 0==e?void(q=!1):void(t>0&&(this.customSettings.numFilesQueued+=t,this.startUpload(),this.setButtonDisabled(!0)))}function g(e,a){var i="";switch(a){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:i="Превышен лимит загружаемых файлов";break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:i="Превышен максимальный размер файла";break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:i="Размер файла равен 0";break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:i="Неверный тип файла"}t(i,!1,!0)}function f(e){var t=this.customSettings.type;switch(t){case i.photo:var s=T;e.name.length>=20&&(e.name=e.name.substring(0,20)+"..."),w(t,'<table style="width:98%"><tr><td width="165"><div class="photo-progress">                                  <div class="progress-title">                                     <div class="progress-cell"><div>'+e.name+"<br />"+v(e.size)+'</div></div>                                  </div>                                  <div class="progress-bg"><!--//--></div>                               </div></td>                               <td valign="top">                                    <div class="photo-text">'+S(t,s,a.lang.photo_tip,"")+k(t,s,"type")+"</div>                                    "+j("photo-align",s,"center")+"                                    "+j("photo-zoom",s,0)+'                                    <div class="clear"></div>                               </td>                               </tr></table>',!1),H[e.index]={i:s,block:x(s)},q&&(q=s);break;case i.gallery:var l=I[this.customSettings.index];if(l.bytesTotal===!1){for(var o=0,n=this.getStats(),r=!1,s=e.index,d=0;d<n.files_queued;d++)r=this.getFile(s++),r&&-1==r.filestatus&&(o+=r.size);l.bytesTotal=o,l.bytesLoaded=0}}}function b(e,t){switch(this.customSettings.type){case i.photo:var a=H[e.index],s=166;s=s/100*Math.ceil(t/e.size*100),$("div.progress-bg",a.block).stop().animate({width:s});break;case i.gallery:var l=I[this.customSettings.index],o=l.bytesLoaded+t,n=o>0?Math.ceil(o/l.bytesTotal*100):0;l.$status.html((n>=100?100:n)+"%")}}function m(){if(this.getStats().files_queued>0)this.startUpload();else{switch(q=!1,this.customSettings.type){case i.photo:n(!1);break;case i.gallery:var e=this.customSettings.index;n(e);var t=I[e];t.bytesTotal=!1,t.bytesLoaded=0,t.$status.html(a.lang.photo_add)}this.setButtonDisabled(!1)}}function y(e,t){t=$.parseJSON(t);var s=this.customSettings.type;switch(s){case i.photo:var l=H[e.index];if(t.success){$("div.photo-progress",l.block).html('<img src="'+t.t+'" />').append('<input type="hidden" name="'+k(s,l.i,!1)+'" class="photo-content" value="'+t.filename+'" />').append('<input type="hidden" name="'+k(!1,l.i,"view")+'"  value="'+t.view+'" />'),B.push([t.filename,s]);var o=$("textarea:visible",l.block);a.wyPhotos?W(o):o.focus()}else $("div.photo-progress",l.block).replaceWith('<div class="photo-error">'+e.name+"<br>"+v(e.size)+"<br>"+t.error+"</div>"),$("div.photo-text",l.block).remove();break;case i.gallery:var n=this.customSettings.index,r=I[n];if(t.success){var d=++r.k;r.$items.append('<tr class="j-gallery-item-block"><td><span class="gallery-item">                                <input type="hidden" name="'+k(s,n,!1,"[p]["+d+"]")+'" class="photo-content" value="'+t.filename+'" />                                <a href="'+t.v+'" rel="pg'+n+'"><img src="'+t.t+'" /></a>                            </span>                            <div class="gallery-edit">                               '+S(s,n,a.lang.photo_tip,"","","[p]["+d+"]")+'<br /><br />                                <a href="#" class="ajax desc ph_del" rel="'+d+'">'+a.lang.photo_del+'</a>                            </div><div class="clear-all"></div></td></tr>'),B.push([t.filename,s]),r.photos.push(t.filename),p(this,++r.uploaded)}else r.$items.append('<tr class="j-gallery-item-block"><td>                                <span class="gallery-item"></span>                                <div class="gallery-edit"><div class="photo-error">'+e.name+"<br>"+v(e.size)+"<br>"+t.error+"</div></div>                            </td></tr>");r.bytesLoaded+=e.size}}function _(e){switch(t(a.lang.file_upload_error+' "'+e.name+'"',!1,!0),this.customSettings.type){case i.photo:H[e.index]&&C(H[e.index].block);break;case i.gallery:}}function k(e,t,a,s){if(a=a||!1,s=s||"",a)return"type"==a||"del"==a?'<input type="hidden" name="'+F+"[b]["+t+"]"+s+"["+a+']" value="'+e+'" />':F+"[b]["+t+"]"+s+"["+a+"]";switch(e){case i.title:return F+"[t]";case i.text:return F+"[b]["+t+"]"+s+"[text]";case i.quote:return F+"[b]["+t+"]"+s+"[text]";case i.photo:return F+"[b]["+t+"]"+s+"[photo]";case i.gallery:return F+"[b]["+t+"]"+s+"[photo]";case i.video:return F+"[b]["+t+"]"+s+"[video]"}return""}function w(e,t,i,s,l){var o=T++;i===!0&&(t+=k(e,o,"type"));var n='<tr id="pblock-'+o+'" class="j-block" block-id="'+o+'" block-type="'+e+'">                            <td class="dragger" align="left" valign="middle"><div class="adragger"><!--//--></div></td>                            <td><div class="mask">'+t+'<div class="mask-top"><div class="insert">'+a.lang.insert+'</div></div><div class="mask-bottom"><!--//--></div><div class="clear"><!--//--></div></div></td>                            <td class="action" align="right" valign="middle">'+(s||"")+'<div class="close"></div></td>                        </tr>';return l===!0?n:(q?x(q).before(n):J.append(n),o)}function x(e){return J.find("#pblock-"+e)}function S(e,t,s,l,o,n,r){if(r=r||"",Q&&e!=i.video&&!r.length){if(!$.isPlainObject(l)&&l.length>0&&0==l.indexOf("{")&&(l=$.parseJSON(l)),!$.isPlainObject(l)){l={};for(var d in a.langs)l[a.langs[d]]=""}var c="";for(var d in a.langs){var u=a.langs[d];c+='<div class="'+u+(L!=u?" hidden":"")+'">'+S(e,t,s,l[u],o,n,u)+"</div>"}return c}l=l||"",o=o||"";var p="";switch(e){case i.title:case i.subtitle:p+="resize:none;";break;case i.photo:case i.gallery:o+=" photo",p+=" width:100%;";break;case i.text:p+=" width:99%;"}var v=k(e===i.title?i.title:i.text,t,!1,n),c='<textarea name="'+v+(""!=r?"["+r+"]":"")+'" id="publicator-text-'+t+(""!=r?"-"+r:"")+'" '+(o.length?' class="'+o+'"':"")+(""!=p?' style="'+p+'"':"")+">"+l+"</textarea>";return c+=e===i.title?'<div class="tip'+(l.length?" hidden":"")+'"><label>'+a.lang.title+" <span>"+a.lang.title_empty+"</span></label></div>":e===i.subtitle?'<div class="tip'+(l.length?" hidden":"")+'">'+s+"</div>":'<div class="tip'+(l.length?" hidden":"")+'">'+s+"</div>",a.useWY&&(e==i.photo&&a.wyPhotos||e==i.text||e==i.quote)&&(c+='<div class="text-to-wy'+(e==i.quote?" quote":"")+'">'+l+"</div>"),c}function j(e,t,i){switch(e){case"photo-align":if(!a.m.photo_align)break;var s=[["left","слева"],["center","по-центру"],["right","справа"]],l=k(!1,t,"align"),o="";for(var n in s)o+='<label><input type="radio" name="'+l+'" '+(i==s[n][0]?'checked="checked"':"")+' value="'+s[n][0]+'" /> '+s[n][1]+"</label>";return'<div class="photo-align">'+o+"</div>";case"photo-zoom":if(!a.m.photo_zoom)break;return'<div class="photo-zoom"><label><input type="checkbox" name="'+k(!1,t,"zoom")+'" '+(1==i?'checked="checked"':"")+" /> zoom</label></div>";case"subtitle-size":i=intval(i);var r=[2,3,4,5,6],d="";for(var n in r)d+='<option value="'+r[n]+'"'+(r[n]===i?" selected":"")+">H"+r[n]+"</option>";return'<div class="size"><select name="'+k(!1,t,"size")+'">'+d+"</select></div>"}return""}function C(e,t){e.find(".mask").animate({opacity:"toggle",height:"toggle"},600,function(){t?e.addClass("displaynone"):e.remove()})}function E(e,t,a,s){var l="";return l+='<input name="'+(F+"[b]["+a+"][source]")+'" type="hidden" value="'+t+'" class="video-source" />',s&&s.hasOwnProperty("embed")&&(l+='<input name="'+(F+"[b]["+a+"][embed]")+'" type="hidden" value="'+s.embed+'" class="video-embed-url" />'),s&&s.hasOwnProperty("thumb")&&(l+='<input name="'+(F+"[b]["+a+"][thumb]")+'" type="hidden" value="'+s.thumb+'" class="video-thumb-url" />'),"vk"==t?(-1==e.indexOf("video_ext.php")&&(e="http://vk.com/video_ext.php?"+e),'<div align="center"><iframe src="'+e+'" width="640" height="363" frameborder="0"></iframe>'+l+'                             <textarea name="'+k(i.video,a,!1)+'" style="display:none;" class="video-content">'+e+"</textarea>                             "+k(i.video,a,"type")+"</div>"):'<div align="center">                            <object width="640" height="363">                                <param name="allowfullscreen" value="true" />                                <param name="allowscriptaccess" value="always" />                                <param name="wmode" value="transparent" />                                <param name="movie" value="'+e+'" />                                <embed src="'+e+'" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" wmode="transparent" width="640" height="363"></embed>                            </object>'+l+'                            <textarea name="'+k(i.video,a,!1)+'" style="display:none;" class="video-content">'+e+"</textarea>                            "+k(i.video,a,"type")+"                        </div>"}function z(e){var t=I[e],s=x(e);t.$items=$(".gallery-items:first",s),t.edit||($(".pg-view",s).remove(),$(".pg-edit",s).removeClass("displaynone"),$("td.action .edit",s).remove(),$("textarea",s).each(function(e,t){$(t).height(t.scrollHeight>0?t.scrollHeight:20)}),n(e),n(!1),t.edit=!0),t.$status=$(".gallery-item:last a",s),t.$items.delegate("tr a.ph_del","click",function(){if(!confirm(a.lang.del))return!1;var s=$(this).closest(".j-gallery-item-block"),l=$(".photo-content",s).val();return D(l)?bff.ajax(a.url+"img_delete",{photos:[[l,i.gallery]],id:a.id},function(e){if(e&&e.success){if(U(l),t.photos.length)for(var a in t.photos)if(t.photos[a]==l){t.photos.splice(a,1);break}s.remove(),p(t.swfu,--t.uploaded)}}):($(this).parent().append(k(i.gallery,e,"del","[p]["+$(this).attr("rel")+"]")),s.hide(),p(t.swfu,--t.uploaded)),!1}),c(e,i.gallery,{index:e,placeholder:"pg-"+e+"-upload"})}function D(e){for(var t in B)if(B[t][0]==e)return!0;return!1}function U(e){if(e.length&&B.length)if($.isArray(e))for(var t in B)for(var a in e)B[t][0]==e[a]&&B.splice(t,1);else for(var t in B)if(B[t][0]==e){B.splice(t,1);break}}function W(e){e=$(e),e.next().addClass("hidden").next().addClass("hidden");var t=intval(e.closest(".j-block").attr("block-id"));P[t]=e.bffWysiwyg({controls_hide:["fullscreen","indent","outdent"],reformator:a.useReformator},!0),P[t].focus(!0)}function R(e){e!==L&&(N.find("."+L).toggleClass("hidden"),N.find("."+e).toggleClass("hidden"),a.useWY&&N.find("textarea.wy").each(function(){$(this).parent().parent().find("textarea:not(.wy)").length&&W($(this).removeClass("wy"))}),a.wyPhotos&&N.find("div.photo-text textarea:visible").each(function(){W(this)}),L=e,O.removeClass("active").filter('[rel="'+L+'"]').addClass("active"))}l&&$.extend(a,l||{});var O,P=[],T=1,q=!1,F="pdata",Y=!1,B=[],H=[],I={},L=!1,Q=!1,M=!1;a.fieldname&&(F=a.fieldname),a.m.use_wysiwyg?(a.m.photo_wysiwyg||(a.wyPhotos=!1),a.m.use_reformator&&(a.useReformator=!0)):a.useWY=a.wyPhotos=!1,a.langs!==!1&&(Q=!0,L=a.langs_cur);var N=$(e)||null;if(!N)return t(a.lang.init_error);var A=N.find(".canvas"),J=N.find("table.publicatorBlocks");return r(),setTimeout(o,0),{getContainer:function(){return N},ajaxSave:d,setLang:R}}function t(e,t,a){return bff.error?bff.error(e,{success:t?!0:!1,append:a?!0:!1}):alert(e),!1}var a={m:{name:"",photo_wysiwyg:!1,photo_align:!1,photo_zoom:!1,gallery_photos_limit:0},url:"",id:0,title:!0,useWY:!0,useReformator:!1,wyPhotos:!0,langs:!1,textHeight:20,upload:{maxSize:"8 MB"},debug:!1,lang:{init_error:"Ошибка инициализации",title:"Заголовок",title_empty:"Укажите текст заголовка",del:"Удалить?",text_tip:"Добавить текст",subtitle_tip:"Подзаголовок",images_all:"Все изображения",file_upload_error:"Ошибка загрузки файла",photo_tip:"Без описание",photo_del:"удалить фото",photo_add:"добавить фото",video_tip:"Укажите ссылку на видео",video_supported:"Поддерживаются: YouTube, Vimeo, RuTube, Vkontakte",video_submit:"Готово",video_not_valid:"Неверный формат ссылки",insert:""}},i={title:0,text:1,photo:2,video:3,subtitle:4,gallery:5,quote:6},s=$(window);return{init:e}}();